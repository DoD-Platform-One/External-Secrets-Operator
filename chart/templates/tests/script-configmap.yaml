{{- if .Values.bbtests.enabled -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: external-secrets-test-script-configmap
data:
  test.sh: |
    #!/bin/bash
    set -ex
    expected="{{ .Values.bbtests.secrets.testsecret.value }}"
    secret_path="/mnt/externalsecrets/secretkey"
    echo "[INFO] Validating secret content in: $secret_path"
    echo "[INFO] Secret file path : ${secret_path}"
    
    if [ ! -f "$secret_path" ]; then
      echo "[ERROR] Secret file not found at $secret_path"
      exit 1
    fi
    
    if grep -q "$expected" "$secret_path"; then
      echo "[SUCCESS] Secret contains expected value."
    else
      echo "[ERROR] Secret value did not match expected content."
      exit 1
    fi
{{- end }}    
           